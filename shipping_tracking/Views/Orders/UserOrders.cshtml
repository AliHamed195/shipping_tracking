<div class="row mt-4">
    <table class="table">
        <thead>
            <tr>
                <th>#</th>
                <th>Total Price</th>
                <th>Order Status</th>
                <th>Created On</th>
                <th>Options</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

@section Scripts {
    <!-- In the <head> section of your layout -->
    <link rel="stylesheet" href="~/lib/datatable/dataTables.bootstrap4.min.css" />

    <!-- Before the closing </body> tag in your layout -->
    <script src="~/lib/datatable/jquery.dataTables.min.js"></script>
    <script src="~/lib/datatable/dataTables.bootstrap4.min.js"></script>

    <script>
        $(document).ready(function () {
            var counter = 1; // Row counter

            var table = $('.table').DataTable({
                ajax: {
                    url: '/api/Cart/Get',
                    dataSrc: ''
                },
                columns: [
                    {
                        data: null,
                        render: function (data, type, row, meta) {
                            return counter++;
                        }
                    },
                    { data: 'totalPrice' },
                    { data: 'orderStatus' },
                    { data: 'createdOn' },
                    {
                        data: null, 
                        render: function (data, type, row) {
                            if (row.orderStatus !== 'Cancelled') {
                                return `<button class="btn btn-danger js-delete" data-order-id="${row.orderID}">Cancel</button>
                                                <button class="btn btn-info js-info" data-order-id="${row.orderID}">Info</button>`;
                            } else {
                                return `<button class="btn btn-info js-info" data-order-id="${row.orderID}" style="width:50%;">Info</button>`;
                            }
                        }
                    }
                ],
                destroy: true,
                order: [[3, "desc"]]
            });

            $('.table').on('click', '.js-delete', function () {
                var button = $(this);
                var id = button.data('order-id');

                Swal.fire({
                    title: 'Are you sure you want to cancel this order?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, cancel it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: '/api/Cart/Cancel/' + id,
                            method: 'PUT',
                            success: function () {
                                Swal.fire(
                                    'Cancelled!',
                                    'The order has been cancelled.',
                                    'success'
                                );
                                var row = table.row(button.parents('tr'));
                                var rowData = row.data();
                                rowData.orderStatus = 'Cancelled';
                                row.data(rowData).invalidate().draw();
                            },
                            error: function () {
                                Swal.fire(
                                    'Error!',
                                    'An error occurred while cancelling the order.',
                                    'error'
                                );
                            }
                        });
                    }
                });
            });
        });
    </script>

}